<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Stack Focus Scroll</title>
    <style>
        body {
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #000;
            overflow: hidden;
            touch-action: none;
        }

        .scene {
            position: relative;
            width: 320px;
            height: 450px;
            perspective: 1500px;
        }

        .stack {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
            cursor: grab;
        }

        .stack.opened {
            transform: rotateX(5deg) rotateY(-35deg) translateX(100px);
        }

        .cardo {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 25px;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            background: #111;
            border: 1px solid rgba(255,255,255,0.1);
            /* اضافه کردن ترنزیشن برای نرم شدن اسکیل و جابجایی */
            transition: transform 0.3s ease-out, opacity 0.4s, filter 0.3s;
            pointer-events: none;
        }

        .cardo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            user-select: none;
        }
    </style>
</head>
<body>

    <div class="scene">
        <div class="stack" id="stack">
            <div class="cardo"><img src="https://picsum.photos/400/600?random=1"></div>
            <div class="cardo"><img src="https://picsum.photos/400/600?random=2"></div>
            <div class="cardo"><img src="https://picsum.photos/400/600?random=3"></div>
            <div class="cardo"><img src="https://picsum.photos/400/600?random=4"></div>
            <div class="cardo"><img src="https://picsum.photos/400/600?random=5"></div>
            <div class="cardo"><img src="https://picsum.photos/400/600?random=6"></div>
            <div class="cardo"><img src="https://picsum.photos/400/600?random=7"></div>
            <div class="cardo"><img src="https://picsum.photos/400/600?random=8"></div>
            <div class="cardo"><img src="https://picsum.photos/400/600?random=9"></div>
            <div class="cardo"><img src="https://picsum.photos/400/600?random=10"></div>
        </div>
    </div>

    <script>
        const stack = document.getElementById('stack');
        const cards = document.querySelectorAll('.cardo');
        
        let isOpen = false;
        let isDragging = false;
        let startX = 0;
        let scrollPos = 0;

        function init() {
            cards.forEach((card, i) => {
                card.style.transform = `translateY(${i * 10}px) translateZ(${i * -15}px)`;
                card.style.zIndex = 10 - i;
            });
        }
        init();

        stack.addEventListener('click', () => {
            if (!isOpen) {
                isOpen = true;
                stack.classList.add('opened');
                updateCards();
            }
        });

        window.addEventListener('pointerdown', e => { if(isOpen) { isDragging = true; startX = e.clientX; } });
        window.addEventListener('pointerup', () => isDragging = false);
        window.addEventListener('pointermove', e => {
            if (!isDragging || !isOpen) return;
            scrollPos += (startX - e.clientX) * 2.5;
            startX = e.clientX;
            scrollPos = Math.max(0, Math.min(scrollPos, 2200));
            updateCards();
        });

        window.addEventListener('wheel', e => {
            if (!isOpen) return;
            scrollPos += e.deltaY;
            scrollPos = Math.max(0, Math.min(scrollPos, 2200));
            updateCards();
        });

        function updateCards() {
            cards.forEach((card, i) => {
                const z = (i * -220) + (scrollPos * 0.9);
                const x = (i * 60) - (scrollPos * 0.25);
                
                // محاسبه فاصله تا نقطه فوکوس (مثلاً وقتی Z نزدیک به 0 است)
                const distanceFromFocus = Math.abs(z);
                let scale = 1;
                let translateY = 0;

                // اگر کارت در محدوده جلویی باشد (فوکوس)
                if (distanceFromFocus < 150) {
                    // هرچه به مرکز نزدیکتر، اسکیل بیشتر و جابجایی رو به بالا بیشتر
                    const factor = (150 - distanceFromFocus) / 150; 
                    scale = 1 + (factor * 0.15); // تا ۱۵ درصد بزرگتر
                    translateY = factor * -40;   // تا ۴۰ پیکسل بالاتر
                }

                const opacity = z > 600 ? 0 : (z < -1600 ? 0 : 1);

                card.style.transform = `
                    translateX(${x}px) 
                    translateZ(${z}px) 
                    translateY(${translateY}px) 
                    rotateY(15deg) 
                    scale(${scale})
                `;
                card.style.zIndex = Math.round(z + 5000);
                card.style.opacity = opacity;
                
                // افکت اختیاری: تار کردن کارت‌های دور
                card.style.filter = `blur(${distanceFromFocus > 300 ? '2px' : '0px'})`;
            });
        }
    </script>
</body>
</html>