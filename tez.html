<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apple Style 3D Stack</title>
    <style>
        :root {
            --card-width: 320px;
            --card-height: 460px;
            --bg-color: #050505;
        }

        body {
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--bg-color);
            overflow: hidden;
            touch-action: none;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        .scene {
            position: relative;
            width: 100%;
            height: 100%;
            perspective: 2500px;
            display: flex;
            justify-content: center;
            align-items: center;
            background: radial-gradient(circle at center, #1a1a1a 0%, #050505 100%);
        }

        .stack {
            width: var(--card-width);
            height: var(--card-height);
            position: relative;
            transform-style: preserve-3d;
            cursor: grab;
        }

        .stack:active { cursor: grabbing; }

        .card {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 32px;
            overflow: hidden;
            /* استایل شیشه‌ای اپل */
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7);
            
            /* انیمیشن نرم اپلی */
            transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1), 
                        opacity 0.6s ease, 
                        filter 0.6s ease;
            
            will-change: transform, opacity, filter;
        }

        .card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            pointer-events: none;
            /* ایجاد یک لایه نوری روی عکس */
            mask-image: linear-gradient(to bottom, black 80%, transparent);
        }

        /* افکت انعطاف پذیر نوری (Reflection) */
        .card::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 50%);
            pointer-events: none;
        }

        .hint {
            position: fixed;
            bottom: 40px;
            color: rgba(255, 255, 255, 0.4);
            font-size: 13px;
            letter-spacing: 1px;
            text-transform: uppercase;
        }
    </style>
</head>
<body>

    <div class="scene">
        <div class="stack" id="stack">
            <div class="card"><img src="https://picsum.photos/600/900?random=1"></div>
            <div class="card"><img src="https://picsum.photos/600/900?random=2"></div>
            <div class="card"><img src="https://picsum.photos/600/900?random=3"></div>
            <div class="card"><img src="https://picsum.photos/600/900?random=4"></div>
            <div class="card"><img src="https://picsum.photos/600/900?random=5"></div>
            <div class="card"><img src="https://picsum.photos/600/900?random=6"></div>
            <div class="card"><img src="https://picsum.photos/600/900?random=7"></div>
            <div class="card"><img src="https://picsum.photos/600/900?random=8"></div>
            <div class="card"><img src="https://picsum.photos/600/900?random=9"></div>
            <div class="card"><img src="https://picsum.photos/600/900?random=10"></div>
        </div>
    </div>
    
    <div class="hint">Swipe to explore</div>

    <script>
        const stack = document.getElementById('stack');
        const cards = Array.from(document.querySelectorAll('.card'));
        
        let isOpen = false;
        let isDragging = false;
        let startX = 0;
        let scrollValue = 0;
        let targetScroll = 0;
        const step = 280; // فاصله بین کارت‌ها

        // مقداردهی اولیه به صورت انباشته
        function init() {
            cards.forEach((card, i) => {
                card.style.transform = `translateY(${i * 4}px) translateZ(${-i * 40}px) scale(${1 - i * 0.02})`;
                card.style.zIndex = cards.length - i;
            });
        }
        init();

        stack.addEventListener('click', () => {
            if (!isOpen) {
                isOpen = true;
                update();
            }
        });

        // مدیریت درگ با اینرسی نرم
        window.addEventListener('pointerdown', e => { if(isOpen) { isDragging = true; startX = e.clientX; } });
        window.addEventListener('pointerup', () => {
            isDragging = false;
            // Snapping: قفل شدن روی نزدیک‌ترین کارت
            targetScroll = Math.round(targetScroll / step) * step;
            update();
        });

        window.addEventListener('pointermove', e => {
            if (!isDragging || !isOpen) return;
            const delta = startX - e.clientX;
            targetScroll += delta * 1.5;
            startX = e.clientX;
            update();
        });

        window.addEventListener('wheel', e => {
            if (!isOpen) return;
            targetScroll += e.deltaY * 0.5;
            update();
        });

        function update() {
            // محدودیت اسکرول
            const maxScroll = (cards.length - 1) * step;
            targetScroll = Math.max(0, Math.min(targetScroll, maxScroll));
            
            cards.forEach((card, i) => {
                const cardPos = (i * step) - targetScroll;
                const distanceNormalized = cardPos / step;
                const absDistance = Math.abs(distanceNormalized);

                // محاسبات هندسی اپل-مانند
                // کارت‌ها در مرکز کاملاً صاف و در کناره‌ها کمی منحرف می‌شوند
                const x = cardPos * 0.9;
                const z = -absDistance * 120;
                const scale = 1 - (absDistance * 0.15);
                const rotateY = distanceNormalized * -12; // چرخش ملایم کناری
                const opacity = 1 - (absDistance * 0.4);
                const blur = Math.min(absDistance * 4, 10); // مات شدن کارت‌های دور

                card.style.transform = `
                    translateX(${x}px) 
                    translateZ(${z}px) 
                    rotateY(${rotateY}deg)
                    scale(${scale})
                `;
                
                card.style.opacity = Math.max(0, opacity);
                card.style.filter = `blur(${blur}px)`;
                card.style.zIndex = Math.round(1000 - absDistance * 100);
            });
        }
    </script>
</body>
</html>